apiVersion: admin.gloo.solo.io/v2
kind: GatewayLifecycleManager
metadata:
  name: istio-ingressgateway
  namespace: gloo-mesh
  annotations:
    argocd.argoproj.io/sync-wave: "-7"
spec:
  installations:
      # The revision for this installation, such as 1-20
    - gatewayRevision: 1-20
      # List all workload clusters to install Istio into
      clusters:
      - name: cluster1
        # If set to true, the spec for this revision is applied in the cluster
        activeGateway: true
      istioOperatorSpec:
        # No control plane components are installed
        profile: empty
        # Solo.io Istio distribution repository; required for Gloo Istio.
        # You get the repo key from your Solo Account Representative.
        hub: us-docker.pkg.dev/gloo-mesh/istio-workshops
        # The Solo.io Gloo Istio tag
        tag: 1.20.2-solo
        values:
          gateways:
            istio-ingressgateway:
              customService: true
        components:
          ingressGateways:
          - name: istio-ingressgateway
            namespace: istio-gateways
            enabled: true
            label:
              istio: ingressgateway
              app: istio-ingressgateway
            k8s:
              service:
                type: LoadBalancer
                selector:
                  istio: ingressgateway
                # Default ports
                ports:
                  # Port for health checks on path /healthz/ready.
                  # For AWS ELBs, this port must be listed first.
                  - name: status-port
                    port: 15021
                    targetPort: 15021
                  # Main HTTP ingress port
                  - name: http2
                    port: 80
                    targetPort: 8080
                  # Main HTTPS ingress port
                  - name: https
                    port: 443
                    targetPort: 8443
                  - name: tls
                    port: 15443
                    targetPort: 15443